function onload(){const e=document.getElementById("signalInput"),t=document.getElementById("annotationInput");function n(t,n){var a=document.getElementById("canvas"),i=document.getElementById("RRCanvas"),d=document.documentElement.clientWidth;d=Math.min(1080,d),a.width=5*d,a.style.width=d+"px",a.height=2400,a.style.height="480px",i.width=a.width,i.style.width=a.style.width,i.height=2400,i.style.height="480px";var o=a.getContext("2d");o.lineWidth=5,o.fillStyle="#0E47D6";var h,l,c,r,u=i.getContext("2d");function m(){h=document.getElementById("hertz").value,c=Math.min(t.length,document.getElementById("frame").value*h),c=Math.max(c,h),document.getElementById("frame").value=c/h,l=Math.round(document.getElementById("startTime").value*h)+1,l=Math.max(1,l),l=Math.min(t.length-c+1,l),document.getElementById("startTime").value=(l-1)/h,r=l-1+c}function s(e){o.clearRect(0,0,a.width,a.height);var t=[];for(annoIndex=0;annoIndex<n.length;annoIndex++)n[annoIndex]>=l&&n[annoIndex]<r&&t.push(n[annoIndex]);if(e.length>0){var i=Math.max(...e),d=Math.min(...e);d-=.04*((i+=.04*(i-d))-d);var h,c=e.length-1,u=0;function m(e){return Math.round((e-u)/(c-u)*(a.width-1))}function s(e){var t=1-(e-d)/(i-d);return Math.round(t*(a.height-1))}for(o.beginPath(),o.moveTo(m(0),s(e[0])),h=1;h<e.length;h++)o.lineTo(m(h),s(e[h]));if(o.stroke(),t.length>0)for(anIndex=0;anIndex<t.length;anIndex++)o.beginPath(),o.arc(m(t[anIndex]-l+1),s(e[t[anIndex]-l+1]),20,0,2*Math.PI),o.fill()}}function g(){if(u.clearRect(0,0,i.width,i.height),u.beginPath(),u.rect(0,0,i.width,i.height),u.strokeStyle="black",u.stroke(),n.length>1){var e,a=[];for(e=1;e<n.length;e++)a.push(n[e]-n[e-1]);var d=Math.max(...a),o=Math.min(...a);o-=.04*((d+=.04*(d-o))-o);var h=t.length,l=1;function c(e){return Math.round((e-l)/(h-l)*(i.width-1))}function r(e){var t=1-(e-o)/(d-o);return Math.round(t*(i.height-1))}for(u.beginPath(),u.moveTo(c(n[1]),r(a[0])),e=1;e<a.length;e++)u.lineTo(c(n[e+1]),r(a[e]));u.strokeStyle="#860010",u.stroke()}}function f(e,t){return t.pageX-function(e){var t=0;if(e.offsetParent){do{t+=e.offsetLeft}while(e=e.offsetParent);return t}}(e)}u.lineWidth=5,m(),s(t.slice(l-1,r)),g(),document.addEventListener("keydown",function(e){switch(e.code){case"ArrowLeft":l=Math.max(1,l-Math.round(c/2)),document.getElementById("startTime").value=(l-1)/h,r=l-1+c,s(t.slice(l-1,r));break;case"ArrowRight":l=Math.min(t.length-c+1,l+Math.round(c/2)),document.getElementById("startTime").value=(l-1)/h,r=l-1+c,s(t.slice(l-1,r))}}),document.getElementById("update").addEventListener("click",function(){m(),s(t.slice(l-1,r))}),document.getElementById("done").addEventListener("click",function(){var t=new Blob([n],{type:"text/csv; encoding:utf-8"});saveAs(t,"anno"+e.files[0].name)}),a.addEventListener("click",function(e){var i,d=5*f(this,e),o=Math.round(d/(a.width-1)*c+l);for(i=0;i<n.length;i++){if(Math.abs(o-n[i])/c*(a.width-1)<=30){n.splice(i,1),s(t.slice(l-1,r)),g();break}if(n[i]>o){n.splice(i,0,o),s(t.slice(l-1,r)),g();break}}}),i.addEventListener("click",function(e){var n=5*f(this,e),a=Math.round(n/(i.width-1)*t.length);l=a-c/2,l=Math.max(1,l),l=Math.min(t.length-c+1,l),document.getElementById("startTime").value=(l-1)/h,r=l-1+c,s(t.slice(l-1,r))})}document.getElementById("ready").addEventListener("click",function(){const a=e.files;a.length>0&&Papa.parse(a[0],{dynamicTyping:!0,skipEmptyLines:!0,complete:function(e,a){const i=e.data[0],d=t.files;if(d.length>0)Papa.parse(d[0],{dynamicTyping:!0,skipEmptyLines:!0,complete:function(e,t){var a=e.data[0];n(i,a)}});else{n(i,[])}}})})}