function onload(){const e=document.getElementById("signalInput"),t=document.getElementById("annotationInput");document.getElementById("ready").addEventListener("click",function(){const n=e.files;n.length>0&&Papa.parse(n[0],{dynamicTyping:!0,skipEmptyLines:!0,complete:function(e,n){const a=e.data[0],i=t.files;if(i.length>0)Papa.parse(i[0],{dynamicTyping:!0,skipEmptyLines:!0,complete:function(e,t){var n=e.data[0];o(a,n)}});else{o(a,[])}}})});var n=document.getElementById("canvas"),a=document.getElementById("RRCanvas"),i=document.documentElement.clientWidth;i=Math.min(1080,i),n.width=5*i,n.style.width=i+"px",n.height=2400,n.style.height="480px",a.width=n.width,a.style.width=n.style.width,a.height=1200,a.style.height="240px";var d=n.getContext("2d");d.lineWidth=5,d.fillStyle="#0E47D6";var h=a.getContext("2d");function o(t,i){var o,l,r,c;function u(){o=document.getElementById("hertz").value,r=Math.min(t.length,document.getElementById("frame").value*o),r=Math.max(r,o),document.getElementById("frame").value=r/o,l=Math.round(document.getElementById("startTime").value*o)+1,l=Math.max(1,l),l=Math.min(t.length-r+1,l),document.getElementById("startTime").value=(l-1)/o,c=l-1+r}function s(e){d.clearRect(0,0,n.width,n.height);var t=[];for(annoIndex=0;annoIndex<i.length;annoIndex++)i[annoIndex]>=l&&i[annoIndex]<c&&t.push(i[annoIndex]);if(e.length>0){var a=Math.max(...e),h=Math.min(...e);h-=.04*((a+=.04*(a-h))-h);var o,r=e.length-1,u=0;function s(e){return Math.round((e-u)/(r-u)*(n.width-1))}function m(e){var t=1-(e-h)/(a-h);return Math.round(t*(n.height-1))}for(d.beginPath(),d.moveTo(s(0),m(e[0])),o=1;o<e.length;o++)d.lineTo(s(o),m(e[o]));if(d.stroke(),t.length>0)for(anIndex=0;anIndex<t.length;anIndex++)d.beginPath(),d.arc(s(t[anIndex]-l+1),m(e[t[anIndex]-l+1]),20,0,2*Math.PI),d.fill()}}function m(){if(h.clearRect(0,0,a.width,a.height),h.beginPath(),h.rect(0,0,a.width,a.height),h.strokeStyle="black",h.stroke(),i.length>1){var e,n=[];for(e=1;e<i.length;e++)n.push(i[e]-i[e-1]);var d=Math.max(...n),o=Math.min(...n);o-=.04*((d+=.04*(d-o))-o);var l=t.length,r=1;function c(e){return Math.round((e-r)/(l-r)*(a.width-1))}function u(e){var t=1-(e-o)/(d-o);return Math.round(t*(a.height-1))}for(h.beginPath(),h.moveTo(c(i[1]),u(n[0])),e=1;e<n.length;e++)h.lineTo(c(i[e+1]),u(n[e]));h.strokeStyle="#860010",h.stroke()}}function g(e,t){return t.pageX-function(e){var t=0;if(e.offsetParent){do{t+=e.offsetLeft}while(e=e.offsetParent);return t}}(e)}u(),s(t.slice(l-1,c)),m(),document.addEventListener("keydown",function(e){switch(e.code){case"ArrowLeft":l=Math.max(1,l-Math.round(r/2)),document.getElementById("startTime").value=(l-1)/o,c=l-1+r,s(t.slice(l-1,c));break;case"ArrowRight":l=Math.min(t.length-r+1,l+Math.round(r/2)),document.getElementById("startTime").value=(l-1)/o,c=l-1+r,s(t.slice(l-1,c))}}),document.getElementById("update").addEventListener("click",function(){u(),s(t.slice(l-1,c)),m()}),document.getElementById("done").addEventListener("click",function(){var t=new Blob([i],{type:"text/csv; encoding:utf-8"});saveAs(t,"anno"+e.files[0].name)}),n.addEventListener("click",function(e){var a,d=5*g(this,e),h=Math.round(d/(n.width-1)*r+l);if(i.length>0)if((i[0]-h)/r*(n.width-1)>30)i.unshift(h);else if((h-i[i.length-1])/r*(n.width-1)>30)i.push(h),console.log(h-i[i.length-1]);else for(a=0;a<i.length;a++){if(Math.abs(h-i[a])/r*(n.width-1)<=30){i.splice(a,1);break}if(i[a]>h){i.splice(a,0,h);break}}else i=[h];s(t.slice(l-1,c)),m()}),a.addEventListener("click",function(e){var n=5*g(this,e),i=Math.round(n/(a.width-1)*t.length);l=i-r/2,l=Math.max(1,l),l=Math.min(t.length-r+1,l),document.getElementById("startTime").value=(l-1)/o,c=l-1+r,s(t.slice(l-1,c))},!1)}h.lineWidth=5}