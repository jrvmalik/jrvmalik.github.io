function onload(){const e=document.getElementById("signalInput"),t=document.getElementById("annotationInput");function n(t,n){var a=document.getElementById("canvas"),i=document.documentElement.clientWidth;i=Math.min(1080,i),a.width=5*i,a.style.width=i+"px",a.height=2400,a.style.height="480px";var d,o,l,c,r=a.getContext("2d");function h(){d=document.getElementById("hertz").value,l=Math.min(t.length,document.getElementById("frame").value*d),l=Math.max(l,d),document.getElementById("frame").value=l/d,o=Math.round(document.getElementById("startTime").value*d)+1,o=Math.max(1,o),o=Math.min(t.length-l+1,o),document.getElementById("startTime").value=(o-1)/d,c=o-1+l}function m(e){r.clearRect(0,0,a.width,a.height);var t=[];for(annoIndex=0;annoIndex<n.length;annoIndex++)n[annoIndex]>=o&&n[annoIndex]<c&&t.push(n[annoIndex]);if(e.length>0){var i=Math.max(...e),d=Math.min(...e);d-=.04*((i+=.04*(i-d))-d);var l,h=e.length-1,m=0;function u(e){return Math.round((e-m)/(h-m)*(a.width-1))}function s(e){var t=1-(e-d)/(i-d);return Math.round(t*(a.height-1))}for(r.beginPath(),r.moveTo(u(0),s(e[0])),l=1;l<e.length;l++)r.lineTo(u(l),s(e[l]));if(r.stroke(),t.length>0)for(anIndex=0;anIndex<t.length;anIndex++)r.beginPath(),r.arc(u(t[anIndex]-o+1),s(e[t[anIndex]-o+1]),20,0,2*Math.PI),r.fill()}}r.lineWidth=5,r.fillStyle="#0E47D6",h(),m(t.slice(o-1,c)),document.addEventListener("keydown",function(e){switch(e.code){case"ArrowLeft":o=Math.max(1,o-Math.round(l/2)),document.getElementById("startTime").value=(o-1)/d,c=o-1+l,m(t.slice(o-1,c));break;case"ArrowRight":o=Math.min(t.length-l+1,o+Math.round(l/2)),document.getElementById("startTime").value=(o-1)/d,c=o-1+l,m(t.slice(o-1,c))}}),document.getElementById("update").addEventListener("click",function(){h(),m(t.slice(o-1,c))}),document.getElementById("done").addEventListener("click",function(){var t=new Blob([n],{type:"text/csv; encoding:utf-8"});saveAs(t,"anno"+e.files[0].name)}),a.addEventListener("click",function(e){var i,d=5*function(e,t){return t.pageX-function(e){var t=0;if(e.offsetParent){do{t+=e.offsetLeft}while(e=e.offsetParent);return t}}(e)}(this,e),r=Math.round(d/(a.width-1)*l+o);for(i=0;i<n.length;i++){if(Math.abs(r-n[i])/l*(a.width-1)<=30){n.splice(i,1),m(t.slice(o-1,c));break}if(n[i]>r){n.splice(i,0,r),m(t.slice(o-1,c));break}}})}document.getElementById("ready").addEventListener("click",function(){const a=e.files;a.length>0&&Papa.parse(a[0],{dynamicTyping:!0,skipEmptyLines:!0,complete:function(e,a){const i=e.data[0],d=t.files;if(d.length>0)Papa.parse(d[0],{dynamicTyping:!0,skipEmptyLines:!0,complete:function(e,t){var a=e.data[0];n(i,a)}});else{n(i,[])}}})})}